<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Siege Test — Webserv</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
            referrerpolicy="no-referrer" />
        <style>
            @import url(styles/components/back_button.css);
            body {
                background: #111;
                color: #e9ecef;
                font-weight: 300;
            }
            .section-wrap {
                min-height: 100vh;
                display: flex;
                align-items: flex-start;
            }
            .card-dark {
                background: #1c1f24;
                border: 1px solid #343a40;
            }
            .metric-card.card {
                transition: border-color 0.2s, box-shadow 0.2s;
            }
            .metric-card.good {
                border-color: #198754;
            }
            .metric-card.bad {
                border-color: #dc3545;
            }
            .metric-badge {
                font-size: 0.75rem;
            }
            .metric-value {
                font-size: 1.25rem;
                font-weight: 600;
            }
            .metric-label {
                color: #adb5bd;
            }
            .back-button {
                text-decoration: none;
            }
            .section-page {
                min-height: 100vh;
                display: flex;
            }
        </style>
    </head>
    <body>
        <nav class="navbar sticky-top">
            <div class="px-5 pt-4">
                <a
                    href="/index.html#features"
                    class="back-button text-white-50">
                    <i class="fa-solid fa-angle-left"></i>
                    Back to features
                </a>
            </div>
        </nav>

        <main class="section-wrap section-page">
            <div class="container py-4">
                <div class="card card-dark shadow-lg text-white-50 fw-lighter">
                    <div class="card-body p-4 p-md-5">
                        <h2 class="h2 text-center mb-3 text-white">
                            Siege Stress Testing
                        </h2>
                        <p class="">
                            <strong class="fw-semibold"
                                >Siege is a command-line tool used for HTTP load
                                and stress testing: </strong
                            ><br />
                            it simulates many users hitting a server at the same
                            time and reports how well the server performs under
                            pressure.
                        </p>
                        <p class="">
                            In our assignment, we are required to use Siege to
                            verify that our Webserv implementation can handle
                            requests with availability above
                            <span class="fw-bold text-success">99.5%</span>,
                            without hanging connections, and with stable memory
                            usage during long runs. The results of these tests
                            are shown below.
                        </p>
                        <p class="">
                            <strong>How to run it:</strong> open a terminal and
                            run
                            <code
                                >siege -c 200 -t 30S
                                http://localhost:8080/</code
                            >
                            while the server is running in another terminal.
                            This launches
                            <span class="fw-bold"
                                >200 concurrent clients for 30 seconds</span
                            >
                            and records key metrics such as availability,
                            average response time, and throughput.
                        </p>

                        <div class="row g-3">
                            <!-- Availability -->
                            <div class="col-12 col-md-6 col-lg-4">
                                <div
                                    class="card card-dark metric-card"
                                    data-key="availability"
                                    data-value="100.00"
                                    data-target=">=99.5%">
                                    <div class="card-body">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="metric-label">
                                                Availability
                                            </div>
                                            <span
                                                class="badge metric-badge bg-secondary"
                                                >Target ≥ 99.5%</span
                                            >
                                        </div>
                                        <div class="metric-value text-light">
                                            100.00%
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Avg Response Time -->
                            <div class="col-12 col-md-6 col-lg-4">
                                <div
                                    class="card card-dark metric-card"
                                    data-key="response_time"
                                    data-value="0.03"
                                    data-target="<=0.30s">
                                    <div class="card-body text-light">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="metric-label">
                                                Avg response time
                                            </div>
                                            <span
                                                class="badge metric-badge bg-secondary"
                                                >Target ≤ 0.30 s</span
                                            >
                                        </div>
                                        <div class="metric-value">0.08 s</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Transaction Rate -->
                            <div class="col-12 col-md-6 col-lg-4">
                                <div
                                    class="card card-dark metric-card"
                                    data-key="transaction_rate"
                                    data-value="248.89">
                                    <div class="card-body">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="metric-label">
                                                Transaction rate
                                            </div>
                                        </div>
                                        <div class="metric-value text-light">
                                            248.89 req/s
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Throughput -->
                            <div class="col-12 col-md-6 col-lg-4">
                                <div
                                    class="card card-dark metric-card"
                                    data-key="throughput"
                                    data-value="23.26">
                                    <div class="card-body">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="metric-label">
                                                Throughput
                                            </div>
                                        </div>
                                        <div class="metric-value text-light">
                                            23.26 MB/s
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Failed Transactions -->
                            <div class="col-12 col-md-6 col-lg-4">
                                <div
                                    class="card card-dark metric-card"
                                    data-key="failed_transactions"
                                    data-value="0"
                                    data-target="=0">
                                    <div class="card-body">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="metric-label">
                                                Failed transactions
                                            </div>
                                            <span
                                                class="badge metric-badge bg-secondary"
                                                >Target 0</span
                                            >
                                        </div>
                                        <div class="metric-value text-light">
                                            0
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Longest Transaction -->
                            <div class="col-12 col-md-6 col-lg-4">
                                <div
                                    class="card card-dark metric-card"
                                    data-key="longest_transaction"
                                    data-value="0.73"
                                    data-target="<=1.0s">
                                    <div class="card-body">
                                        <div
                                            class="d-flex justify-content-between align-items-center mb-1">
                                            <div class="metric-label">
                                                Longest transaction
                                            </div>
                                            <span
                                                class="badge metric-badge bg-secondary"
                                                >Target ≤ 1.0 s</span
                                            >
                                        </div>
                                        <div class="metric-value text-light">
                                            0.73 s
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-secondary">
                            <i class="fa-solid fa-circle-info me-2"></i>
                            Availability must remain above 99.5%, connections
                            must close cleanly, and memory usage must stay
                            stable during long runs.
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <script>
            (function () {
                const goals = {
                    availability: (v) => v >= 99.5,
                    response_time: (v) => v <= 0.3,
                    failed_transactions: (v) => v === 0,
                    longest_transaction: (v) => v <= 1.0,
                };
                document.querySelectorAll(".metric-card").forEach((card) => {
                    const key = card.dataset.key;
                    const raw = parseFloat(card.dataset.value);
                    if (!goals[key]) return;
                    const ok = goals[key](raw);
                    card.classList.add(ok ? "good" : "bad");
                    // add pass/fail badge
                    const badge = document.createElement("span");
                    badge.className =
                        "badge metric-badge " +
                        (ok ? "bg-success" : "bg-danger");
                    badge.textContent = ok ? "PASS" : "FAIL";
                    card.querySelector(".d-flex").appendChild(badge);
                });
            })();
        </script>
    </body>
</html>
