<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Webserv: Methods explained</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
            referrerpolicy="no-referrer" />
        <style>
            @import url(styles/components/back_button.css);
            .file-item {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.5rem 0.75rem;
                border: 1px solid #343a40;
                border-radius: 0.5rem;
            }
            .file-name {
                flex: 1;
                font-family: ui-monospace, Menlo, Consolas, monospace;
                word-break: break-all;
            }
            .section-page {
                min-height: 100vh;
                display: flex;
                align-items: center;
            }
            h1 {
                font-size: 100px;
                margin-top: -80px;
                /* margin-bottom: 100px; */
            }
            .float {
                animation: floatY 1s ease-in-out infinite;
            }
            @keyframes floatY {
                0%,
                100% {
                    transform: translateY(0);
                }
                50% {
                    transform: translateY(5px);
                }
            }

            .jump-demo {
                margin-top: 70px;
            }

            .navbar {
                font-family: "Roboto", sans-serif;

                backdrop-filter: blur(10px); /* optional, adds glass effect */
            }
        </style>
    </head>
    <body class="bg-dark text-light">
        <!-- Back -->

        <!-- <div class="px-5 pt-4">
            <a href="/index.html#features" class="back-button text-white-50">
                <i class="fa-solid fa-angle-left"></i>
                Back to features
            </a>
        </div> -->

        <nav class="navbar sticky-top">
            <div class="px-5 pt-4">
                <a
                    href="/index.html#features"
                    class="back-button text-white-50">
                    <i class="fa-solid fa-angle-left"></i>
                    Back to features
                </a>
            </div>
            <!-- <div class="container-fluid">
                <a class="navbar-brand" href="#">Sticky top</a>
            </div> -->
        </nav>
        <!-- PAGE 1: HTTP METHODS -->
        <section id="methods" class="section-page">
            <div class="container">
                <h1 class="text-center">HTTP Methods Explained</h1>
                <p class="my-4 fw-light">
                    HTTP methods are a basic set of operations that can be used
                    to interact with the server. Each method is included in the
                    first line of the HTTP request and tells the server what to
                    do with a specific resource. The server processes the
                    request and answers with an HTTP response that begins with a
                    status code, which describes the type of answer sent back:
                    <span
                        class="fw-light badge bg-dark border border-success mx-1"
                        >2xx: success</span
                    >
                    <span
                        class="fw-light badge bg-dark border border-warning mx-1"
                        >3xx: redirections</span
                    >
                    <span
                        class="fw-light badge bg-dark border border-danger mx-1"
                        >4xx: client errors</span
                    >
                    <span
                        class="fw-light badge bg-dark border border-danger mx-1"
                        >5xx: server errors</span
                    >.
                </p>

                <p class="fw-semibold mt-3">
                    Our webserv handles the current requests:
                </p>
                <div class="d-grid mx-4">
                    <div class="d-flex align-items-center p-2">
                        <span
                            class="badge bg-success me-3 px-3 py-2"
                            style="min-width: 80px; text-align: center"
                            >GET</span
                        >
                        <span
                            >Ask the server to give you something (like a list
                            of files, or a webpage).</span
                        >
                    </div>
                    <div class="d-flex align-items-center p-2">
                        <span
                            class="badge bg-primary me-3 px-3 py-2"
                            style="min-width: 80px; text-align: center"
                            >POST</span
                        >
                        <span
                            >Send something new to the server (like uploading a
                            file).</span
                        >
                    </div>
                    <div class="d-flex align-items-center p-2">
                        <span
                            class="badge bg-warning text-dark me-3 px-3 py-2"
                            style="min-width: 80px; text-align: center"
                            >DELETE</span
                        >
                        <span
                            >Tell the server to remove something (like deleting
                            a file).</span
                        >
                    </div>
                </div>
                <!-- Switch -->

                <div class="jump-demo text-center">
                    <p class="fw-light">
                        We demonstrate two ways requests can be handled, press
                        the arrow below to check on the next page.
                    </p>
                    <a
                        href="#demos"
                        class="text-white-50 fs-2 d-inline-block float">
                        <i class="fa-solid fa-angles-down"></i>
                    </a>
                </div>
            </div>
        </section>

        <!-- PAGE 2: DEMOS (CARD OWNS THE VIEWPORT) -->
        <section id="demos" class="section-page">
            <div class="container py-4">
                <p class="h5 my-2 fw-lighter">
                    Press the buttons to switch between demos:
                </p>
                <div class="card bg-dark shadow-lg m-4">
                    <div class="card-body p-4">
                        <div class="d-flex align-items-center gap-2 mb-4">
                            <button
                                id="showStatic"
                                class="btn btn-outline-light active">
                                Static web pages
                            </button>
                            <button
                                id="showDynamic"
                                class="btn btn-outline-light">
                                Dynamic web pages
                            </button>
                        </div>

                        <!-- Static panel -->
                        <section id="panel-static" class="fw-lighter">
                            <div class="text-white fst-italic">
                                <p class="mb-3">
                                    In our webserv, when you upload a file, the
                                    server sends back a complete HTML page as
                                    the response.<br />
                                    The browser discards the old page and loads
                                    this new one (for example, a “✅ Upload
                                    successful” page).
                                </p>
                                <p class="mb-4">
                                    This was the normal way websites worked
                                    before the rise of modern JavaScript-driven
                                    apps in the mid-2000s. It is called static
                                    because each server response is a full,
                                    fixed document: the client just displays it
                                    without changing anything itself.
                                </p>
                                <p class="fw-semibold mb-2">
                                    <span class="badge bg-danger"
                                        >The drawbacks</span
                                    >
                                </p>
                                <ul class="fw-lighter mb-4">
                                    <li class="mb-2">
                                        Every action forces a full page reload,
                                        which feels slower and less interactive.
                                    </li>
                                    <li class="mb-2">
                                        It increases server cost because the
                                        server rebuilds and resends entire pages
                                        for even small updates.
                                    </li>
                                    <li class="mb-2">
                                        It mixes responsibilities: the server
                                        handles both the data/logic and the page
                                        state, while in modern practice the
                                        server should focus on data and the
                                        client should control presentation and
                                        interactivity.
                                    </li>
                                </ul>

                                <p class="fw-bold">
                                    Choose a file to upload to test it out!
                                </p>

                                <form
                                    action="/upload"
                                    method="POST"
                                    enctype="multipart/form-data"
                                    class="mt-1">
                                    <div
                                        class="d-flex gap-2 align-items-center w-50">
                                        <input
                                            class="form-control"
                                            type="file"
                                            name="file"
                                            id="formFile"
                                            required />
                                        <button
                                            type="submit"
                                            class="btn btn-secondary">
                                            Upload
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </section>

                        <!-- Dynamic panel -->
                        <section id="panel-dynamic" class="d-none">
                            <div
                                class="d-flex flex-column text-white fst-italic fw-lighter">
                                <p class="mb-3">
                                    Nowadays, the server no longer sends a whole
                                    HTML page each time. Instead, it sends back
                                    just raw data, typically in JSON format. The
                                    page does not reload or change its path:
                                    it's the frontend role, via JavaScript, to
                                    update only the parts that need to change
                                    while keeping the user on the same page.
                                </p>
                                <p class="mb-4">
                                    This is the approach used in SPAs
                                    (single-page applications), which became
                                    common from the mid-2000s onward and grew
                                    popular with frameworks like AngularJS,
                                    React, and Vue. The site is called dynamic
                                    because the page can change on the fly
                                    without being fully reloaded.
                                </p>
                                <p class="mb-2 fw-semibold">
                                    <span class="badge bg-success"
                                        >The advantages</span
                                    >
                                </p>
                                <ul class="mb-4">
                                    <li class="mb-2">
                                        Faster and smoother: stay on the same
                                        page; only changed data updates.
                                    </li>
                                    <li class="mb-2">
                                        More interactive: instant reactions to
                                        server responses.
                                    </li>
                                    <li class="mb-2">
                                        More interactive: instant reactions to
                                        server responses.
                                    </li>
                                    <li class="mb-2">
                                        Clear separation: server handles the
                                        data/logic, client handles the page
                                        state and interactivity.
                                    </li>
                                </ul>
                                <p class="fw-bold">
                                    Click on load files to test it out!
                                </p>
                                <div
                                    class="d-flex align-items-center gap-2 mb-3">
                                    <button
                                        id="loadBtn"
                                        class="btn btn-success">
                                        Load files
                                    </button>
                                    <span
                                        id="status"
                                        class="text-secondary"></span>
                                </div>
                                <div
                                    id="alert"
                                    class="alert alert-danger d-none"></div>
                                <ul
                                    id="fileList"
                                    class="list-unstyled d-grid gap-2 mb-3"></ul>
                                <p
                                    id="empty"
                                    class="text-secondary mt-auto d-none mb-0">
                                    No files.
                                </p>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </section>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            // panel toggle
            const btnStatic = document.getElementById("showStatic");
            const btnDynamic = document.getElementById("showDynamic");
            const panelStatic = document.getElementById("panel-static");
            const panelDyn = document.getElementById("panel-dynamic");
            function show(which) {
                const s = which === "static";
                panelStatic.classList.toggle("d-none", !s);
                panelDyn.classList.toggle("d-none", s);
                btnStatic.classList.toggle("active", s);
                btnDynamic.classList.toggle("active", !s);
            }
            btnStatic.addEventListener("click", () => show("static"));
            btnDynamic.addEventListener("click", () => show("dynamic"));

            // GET + DELETE demo
            const ENDPOINT_LIST = "../cgi-bin/files_json.py";
            const DELETE_BASE = "/upload/";

            const loadBtn = document.getElementById("loadBtn");
            const statusEl = document.getElementById("status");
            const alertEl = document.getElementById("alert");
            const listEl = document.getElementById("fileList");
            const emptyEl = document.getElementById("empty");

            if (loadBtn) {
                loadBtn.addEventListener("click", loadFiles);
                listEl.addEventListener("click", onListClick);
            }

            async function loadFiles() {
                clearUI();
                statusEl.textContent = "GET REQUEST SENT…";
                try {
                    const res = await fetch(ENDPOINT_LIST, {
                        cache: "no-store",
                    });
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const json = await res.json();
                    const files = Array.isArray(json)
                        ? json.filter(Boolean)
                        : [];
                    render(files);
                    statusEl.textContent = `GET REQUEST SUCCESS ✅ (${files.length}) files found`;
                } catch (e) {
                    showError(e.message || String(e));
                    statusEl.textContent = "GET REQUEST FAILED ❌";
                }
            }

            function render(files) {
                listEl.innerHTML = files
                    .map(
                        (name) => `
        <li class="file-item" data-name="${escapeAttr(name)}">
          <a class="file-name link-light text-decoration-none"
             href="${DELETE_BASE + encodeURIComponent(name)}"
             target="_blank" rel="noopener">${escapeHtml(name)}</a>
          <button class="btn btn-outline-danger delete-btn" title="Delete">delete</button>
        </li>`
                    )
                    .join("");
                emptyEl.classList.toggle("d-none", files.length !== 0);
            }

            async function onListClick(e) {
                const btn = e.target.closest(".delete-btn");
                if (!btn) return;
                const li = btn.closest(".file-item");
                if (!li) return;
                const name = li.getAttribute("data-name");
                if (!name) return;
                if (!confirm(`Delete "${name}"?`)) return;

                try {
                    const res = await fetch(
                        DELETE_BASE + encodeURIComponent(name),
                        { method: "DELETE" }
                    );
                    if (!res.ok)
                        throw new Error(`Delete failed: HTTP ${res.status}`);
                    li.remove();
                    emptyEl.classList.toggle(
                        "d-none",
                        listEl.children.length !== 0
                    );
                    statusEl.textContent = `Deleted: ${name}`;
                } catch (e2) {
                    showError(e2.message || String(e2));
                }
            }

            function clearUI() {
                alertEl.classList.add("d-none");
                alertEl.textContent = "";
                listEl.innerHTML = "";
                emptyEl.classList.add("d-none");
            }
            function showError(msg) {
                alertEl.textContent = msg;
                alertEl.classList.remove("d-none");
            }
            function escapeHtml(s) {
                return String(s)
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;");
            }
            function escapeAttr(s) {
                return String(s).replace(/"/g, "&quot;");
            }
        </script>
    </body>
</html>
