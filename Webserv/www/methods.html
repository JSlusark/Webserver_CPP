<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Webserv: Methods explained</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
            rel="stylesheet" />
        <style>
            .file-item {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 0.5rem 0.75rem;
                border: 1px solid #343a40;
                border-radius: 0.5rem;
            }
            .file-name {
                flex: 1;
                font-family: ui-monospace, Menlo, Consolas, monospace;
                word-break: break-all;
            }
        </style>
    </head>
    <body class="bg-dark text-light">
        <div class="container py-4">
            <!-- Intro -->
            <section class="mb-4">
                <h2 class="h4">HTTP Methods: GET, POST, DELETE</h2>
                <p class="mb-2">
                    HTTP methods are a basic set of operations that can be used
                    to interact with the server. Each method is included in the
                    first line of the HTTP request and tells the server what to
                    do with a specific resource. The server processes the
                    request and answers with an HTTP response that begins with a
                    status code, which describes the type of answer sent back (
                    <span class="badge bg-success mx-1">2xx: success</span>
                    <span class="badge bg-warning mx-1">3xx: redirections</span>
                    <span class="badge bg-danger mx-1">4xx: client errors</span>
                    <span class="badge bg-dark border border-danger mx-1"
                        >5xx: server errors</span
                    >
                    ).
                </p>
                <p class="mb-2">Our webserv handles the current requests:</p>

                <div class="d-grid gap-2">
                    <div class="d-flex align-items-center p-2 bg-dark">
                        <span
                            class="badge bg-success me-3 px-3 py-2"
                            style="min-width: 80px; text-align: center"
                            >GET</span
                        >
                        <span
                            >Ask the server to give you something (like a list
                            of files, or a webpage).</span
                        >
                    </div>
                    <div class="d-flex align-items-center p-2 bg-dark">
                        <span
                            class="badge bg-primary me-3 px-3 py-2"
                            style="min-width: 80px; text-align: center"
                            >POST</span
                        >
                        <span
                            >Send something new to the server (like uploading a
                            file).</span
                        >
                    </div>
                    <div class="d-flex align-items-center p-2 bg-dark">
                        <span
                            class="badge bg-warning text-dark me-3 px-3 py-2"
                            style="min-width: 80px; text-align: center"
                            >DELETE</span
                        >
                        <span
                            >Tell the server to remove something (like deleting
                            a file).</span
                        >
                    </div>
                </div>
            </section>

            <!-- Short intro -->
            <p class="mb-4 text-center">
                Below we demonstrate two ways requests can be handled:
            </p>

            <!-- Two columns -->
            <div class="row g-4">
                <!-- Left: Static -->
                <div class="col-12 col-lg-6">
                    <div class="border rounded p-3 h-100">
                        <h3 class="h5 mb-3 text-center">Static webpages</h3>
                        <p>
                            In our webserv, when you upload a file, the server
                            sends back a complete HTML page as the response. The
                            browser discards the old page and loads this new one
                            (for example, a “✅ Upload successful” page).
                        </p>
                        <p>
                            This was the normal way websites worked before the
                            rise of modern JavaScript-driven apps in the
                            mid-2000s. It is called static because each server
                            response is a full, fixed document — the client just
                            displays it without changing anything itself.
                        </p>
                        <p><strong>The drawbacks:</strong></p>
                        <ul>
                            <li>
                                Every action forces a full page reload, which
                                feels slower and less interactive.
                            </li>
                            <li>
                                It increases server cost because the server
                                rebuilds and resends entire pages for even small
                                updates.
                            </li>
                            <li>
                                It mixes responsibilities: the server handles
                                both the data/logic and the page state, while in
                                modern practice the server should focus on data
                                and the client should control presentation and
                                interactivity.
                            </li>
                        </ul>

                        <form
                            action="/upload"
                            method="POST"
                            enctype="multipart/form-data"
                            class="mt-3">
                            <label for="formFile" class="form-label"
                                >Upload a file</label
                            >
                            <div class="d-flex gap-2 align-items-center">
                                <input
                                    class="form-control"
                                    type="file"
                                    name="file"
                                    id="formFile"
                                    required />
                                <button type="submit" class="btn btn-secondary">
                                    Upload
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Right: Dynamic -->
                <div class="col-12 col-lg-6">
                    <div class="border rounded p-3 h-100 d-flex flex-column">
                        <h3 class="h5 mb-3 text-center">Dynamic webpages</h3>
                        <p>
                            In the new style, the server no longer sends a whole
                            HTML page each time. Instead, it sends back just raw
                            data, typically in JSON format. The page does not
                            reload or change its path: it’s the frontend role,
                            via JavaScript, to update only the parts that need
                            to change while keeping the user on the same page.
                        </p>
                        <p>
                            This is the approach used in SPAs (single-page
                            applications), which became common from the
                            mid-2000s onward and grew popular with frameworks
                            like AngularJS, React, and Vue. The site is called
                            dynamic because the page can change on the fly
                            without being fully reloaded.
                        </p>
                        <p><strong>The advantages:</strong></p>
                        <ul>
                            <li>
                                Faster and smoother: the user stays on the same
                                page, only the changed data is updated.
                            </li>
                            <li>
                                More interactive: the browser can react
                                instantly to server responses.
                            </li>
                            <li>
                                Clearer separation of concerns: the server
                                handles data and logic, while the client/browser
                                controls page state and interactivity.
                            </li>
                        </ul>

                        <div
                            class="d-flex justify-content-center align-items-center gap-2 mb-3">
                            <button id="loadBtn" class="btn btn-success">
                                Load files
                            </button>
                            <span id="status" class="text-secondary"></span>
                        </div>
                        <div id="alert" class="alert alert-danger d-none"></div>
                        <ul
                            id="fileList"
                            class="list-unstyled d-grid gap-2 mb-3"></ul>
                        <p
                            id="empty"
                            class="text-secondary mt-auto d-none mb-0">
                            No files.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const ENDPOINT_LIST = "../cgi-bin/files_json.py";
            const DELETE_BASE = "/upload/";

            const loadBtn = document.getElementById("loadBtn");
            const statusEl = document.getElementById("status");
            const alertEl = document.getElementById("alert");
            const listEl = document.getElementById("fileList");
            const emptyEl = document.getElementById("empty");

            loadBtn.addEventListener("click", loadFiles);
            listEl.addEventListener("click", onListClick);

            async function loadFiles() {
                clearUI();
                statusEl.textContent = "GET REQUEST SENT…";
                try {
                    const res = await fetch(ENDPOINT_LIST, {
                        cache: "no-store",
                    });
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    const json = await res.json();
                    const files = Array.isArray(json)
                        ? json.filter(Boolean)
                        : [];
                    render(files);
                    statusEl.textContent = `GET REQUEST SUCCESS ✅ (${files.length}) files found`;
                } catch (e) {
                    showError(e.message || String(e));
                    statusEl.textContent = "GET REQUEST FAILED ❌";
                }
            }

            function render(files) {
                listEl.innerHTML = files
                    .map(
                        (name) => `
          <li class="file-item" data-name="${escapeAttr(name)}">
            <a class="file-name link-light text-decoration-none"
               href="${DELETE_BASE + encodeURIComponent(name)}"
               target="_blank" rel="noopener">${escapeHtml(name)}</a>
            <button class="btn btn-outline-danger delete-btn" title="Delete">delete</button>
          </li>`
                    )
                    .join("");
                emptyEl.classList.toggle("d-none", files.length !== 0);
            }

            async function onListClick(e) {
                const btn = e.target.closest(".delete-btn");
                if (!btn) return;

                const li = btn.closest(".file-item");
                if (!li) return;
                const name = li.getAttribute("data-name");
                if (!name) return;

                if (!confirm(`Delete "${name}"?`)) return;

                try {
                    const res = await fetch(
                        DELETE_BASE + encodeURIComponent(name),
                        { method: "DELETE" }
                    );
                    if (!res.ok)
                        throw new Error(`Delete failed: HTTP ${res.status}`);
                    li.remove();
                    emptyEl.classList.toggle(
                        "d-none",
                        listEl.children.length !== 0
                    );
                    statusEl.textContent = `Deleted: ${name}`;
                } catch (e2) {
                    showError(e2.message || String(e2));
                }
            }

            function clearUI() {
                alertEl.classList.add("d-none");
                alertEl.textContent = "";
                listEl.innerHTML = "";
                emptyEl.classList.add("d-none");
            }
            function showError(msg) {
                alertEl.textContent = msg;
                alertEl.classList.remove("d-none");
            }
            function escapeHtml(s) {
                return String(s)
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;");
            }
            function escapeAttr(s) {
                return String(s).replace(/"/g, "&quot;");
            }
        </script>
    </body>
</html>
